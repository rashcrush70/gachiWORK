<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{url_for('static', filename='css/main.css')}}" rel="stylesheet"/>
    <title>Магазин Авто Запчастей</title>
</head>
<body>
    <header>
        <h1>100Болтов</h1>
    </header>

    <div id="navbar">
        <a href="#" onclick="showCatalog()">Каталог</a>
        <button onclick="toggleCart()">Корзина</button> 
    </div>

    <section id="catalog-container" style="display:none;">
        <h2>Марки автомобилей</h2>
        <ul id="car-brands">
            <li onclick="showProducts('Toyota')">Toyota</li>
            <li onclick="showProducts('Ford')">Ford</li>
            <li onclick="showProducts('Honda')">Honda</li>
            <li onclick="showProducts('Nissan')">Nissan</li>
            <li onclick="showProducts('Subaru')">Subaru</li>
        </ul>
    </section>
    
    <div id="products-container">
        <div class="product">
            <h3>Двигатель</h3>
            <p>400.000₸</p>
            <button onclick="addToCart(1, 'Двигатель', 400.000)">Добавить в корзину</button>
        </div>
        <div class="product">
            <h3>Тормоза</h3>
            <p>50.000₸</p>
            <button onclick="addToCart(2, 'Тормоза', 50.000)">Добавить в корзину</button>
        </div>
        <div class="product">
            <h3>Фары</h3>
            <p>85.000₸</p>
            <button onclick="addToCart(3, 'Фары', 80.000)">Добавить в корзину</button>
        </div>
        <div class="product">
            <h3>Бампер</h3>
            <p>100.000₸</p>
            <button onclick="addToCart(4, 'Бампер', 100.000)">Добавить в корзину</button>
        </div>
        <div class="product">
            <h3>Капот</h3>
            <p>180.000₸</p>
            <button onclick="addToCart(5, 'Капот', 170.000)">Добавить в корзину</button>
        </div>
        <div class="product">
            <h3>Усилитель тормоза</h3>
            <p>250.000₸</p>
            <button onclick="addToCart(6, 'Усилитель тормоза', 200.000)">Добавить в корзину</button>
        </div>
    </div>

    <div id="notification" class="fade-out" style="opacity: 0; visibility: hidden; position: fixed; top: 0; left: 50%; transform: translateX(-50%); background-color: #4CAF50; color: white; padding: 15px; text-align: center; transition: opacity 0.3s ease-in-out;"></div>

    <div id="cart-container" style="display:none;">
        <h2>Корзина</h2>
        <ul id="cart"></ul>
        <p>Итого: <span id="total">0.000</span>₸</p>
        <button onclick="checkout()">Купить</button>
        <button onclick="toggleCart()">Назад</button>
    </div>

    <footer>
        <p>&copy; 2023 АО Ресы</p>
    </footer>

    <script>
        const cart = [];

        const catalog = {
            Toyota: [
                { id: 1, name: 'Двигатель Тойота', price: 650.000 },
                { id: 2, name: 'Фары Тойота', price: 150.000 },
            ],
            Ford: [
                { id: 3, name: 'Форд Двигатель', price: 270.000 },
                { id: 4, name: 'Бампер Форд', price: 200.000 },
            ],
            Honda: [
                { id: 5, name: 'Honda Двигатель', price: 350.000 },
                { id: 6, name: 'Honda Капот', price: 100.000 },
            ],
            Nissan: [
                { id: 7, name: 'Nissan Двигатель', price: 355.000 },
                { id: 8, name: 'Ниссан Усилитель Тормоза', price: 70.000 },
            ],
            Subaru: [
                { id: 9, name: 'Двигатель Subaru', price: 500.000 },
                { id: 10, name: 'Subaru Фары', price: 100.000 },
            ],
        };

        function showNotification(message) {
            const notificationElement = document.getElementById('notification');
            notificationElement.textContent = message;
            notificationElement.classList.remove('fade-out');
            notificationElement.style.opacity = '1';
            notificationElement.style.visibility = 'visible';
            setTimeout(() => {
                notificationElement.classList.add('fade-out');
            }, 100);
            setTimeout(() => {
                notificationElement.style.opacity = '0';
                notificationElement.style.visibility = 'hidden';
                notificationElement.classList.remove('fade-out');
            }, 3000);
        }
    
        function addToCart(productId, name, price) {
            const product = {
                id: productId,
                name: name,
                price: price
            };
            cart.push(product);
            updateCart();
            showNotification(`${name} добавлен в корзину!`);
        }

        // Function to remove a product from the cart
        function removeFromCart(productId) {
            const index = cart.findIndex(item => item.id === productId);
            if (index !== -1) {
                cart.splice(index, 1);
                updateCart();
            }
        }

        // Function to update the cart display
        function updateCart() {
            // Implement your cart update logic here
            console.log(cart);
            updateCartDisplay();
        }

        // Function to toggle between product and cart sections
        function toggleCart() {
            const productsContainer = document.getElementById('products-container');
            const cartContainer = document.getElementById('cart-container');
            const cartButtonContainer = document.getElementById('cart-button-container');

            // Toggle visibility
            if (productsContainer.style.display === 'block') {
                productsContainer.style.display = 'none';
                cartContainer.style.display = 'block';
                updateCartDisplay(); // Show the cart contents when switching to the cart view
            } else {
                productsContainer.style.display = 'block';
                cartContainer.style.display = 'none';
            }
        }

        // Function to update the cart display
        function updateCartDisplay() {
            const cartContainer = document.getElementById('cart');

            // Clear previous cart items
            cartContainer.innerHTML = '';

            // Check if there are items in the cart
            if (cart.length > 0) {
                // Display each item in the cart
                cart.forEach(item => {
                    const cartItem = document.createElement('li');
                    cartItem.textContent = `${item.name} - ${item.price.toFixed(3)}₸`;
                    
                    // Add remove button
                    const removeButton = document.createElement('button');
                    removeButton.textContent = 'Убрать';
                    removeButton.onclick = () => removeFromCart(item.id);
                    cartItem.appendChild(removeButton);

                    cartContainer.appendChild(cartItem);
                });

                // Calculate and display the total
                const totalPrice = cart.reduce((total, item) => total + item.price, 0);
                document.getElementById('total').textContent = totalPrice.toFixed(3);
            }
        }

        function updateNavbarSelection(brand) {
            const navbarLinks = document.getElementById('navbar').getElementsByTagName('a');
            for (let i = 0; i < navbarLinks.length; i++) {
                navbarLinks[i].classList.remove('selected');
            }
            document.querySelector(`#navbar a:contains('${brand}')`).classList.add('selected');
        }

        function showProducts(brand) {
            const productsContainer = document.getElementById('products-container');
            const catalogProducts = catalog[brand];
            productsContainer.innerHTML = '';
            if (catalogProducts) {
                catalogProducts.forEach(product => {
                    const productItem = document.createElement('div');
                    productItem.className = 'product';
                    productItem.innerHTML = `
                        <h3>${product.name}</h3>
                        <p>${product.price.toFixed(3)}₸</p>
                        <button onclick="addToCart(${product.id}, '${product.name}', ${product.price})">Добавить в корзину</button>
                    `;
                    productsContainer.appendChild(productItem);
                });
            }
            productsContainer.style.display = 'block';
            updateNavbarSelection(brand);
        }

        function checkout() {
            alert('Спасибо за покупку!');
            cart.length = 0; 
            updateCart();
            toggleCart(); 
        }

        function containsText(element, text) {
            return element.innerText.toLowerCase().includes(text.toLowerCase());
        }

        function showCatalog() {
            const catalogContainer = document.getElementById('catalog-container');
            const productsContainer = document.getElementById('products-container');

            if (catalogContainer.style.display === 'block') {
                catalogContainer.style.display = 'none';
                productsContainer.style.display = 'block';
            } else {
                catalogContainer.style.display = 'block';
                productsContainer.style.display = 'none';
            }

            const navbarLinks = document.getElementById('navbar').getElementsByTagName('a');
            for (let i = 0; i < navbarLinks.length; i++) {
                navbarLinks[i].classList.remove('selected');
            }
            document.querySelector(`#navbar a:contains('Catalog')`).classList.add('selected');
        }
    </script>
</body>
</html>
